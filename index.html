<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂúãÂ∞èÊéíË™≤Á≥ªÁµ± V48.1 (Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background: #f3f4f6; }
        .btn { padding: 5px 12px; border-radius: 6px; font-weight: bold; transition: all 0.1s; font-size: 0.85rem; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 4px; border: none; user-select: none; }
        .btn-blue { background: #2563eb; color: white; } .btn-green { background: #16a34a; color: white; } .btn-red { background: #dc2626; color: white; }
        .btn-gray { background: #e5e7eb; color: #374151; border: 1px solid #d1d5db; } .btn-purple { background: #9333ea; color: white; } .btn-orange { background: #f97316; color: white; }
        .btn-disabled { background: #d1d5db; color: #9ca3af; cursor: not-allowed; box-shadow: none; transform: none; pointer-events: none; }
        .select-btn { border: 1px solid #cbd5e1; background: white; padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; cursor: pointer; transition: all 0.2s; }
        .select-btn.active { background: #2563eb; color: white; border-color: #2563eb; box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3); font-weight: bold; transform: translateY(-1px); }
        .text-role-director { color: #9333ea; font-weight: 800; } .text-role-chief { color: #2563eb; font-weight: 800; } .text-role-teacher { color: #16a34a; font-weight: 800; } .text-role-homeroom { color: #374151; font-weight: normal; }
        .sub-color-eng { color: #2563eb; font-weight: 800; } .sub-color-soc { color: #d97706; font-weight: 800; } .sub-color-sci { color: #16a34a; font-weight: 800; }
        .sub-color-life { color: #0d9488; font-weight: 800; } .sub-color-pe { color: #dc2626; font-weight: 800; } .sub-color-art { color: #9333ea; font-weight: 800; }
        .sub-color-health { color: #be123c; font-weight: 800; } .sub-color-native { color: #ea580c; font-weight: 800; } .sub-color-it { color: #4f46e5; font-weight: 800; }
        .sub-color-default { color: #111827; }
        .editor-grid { display: grid; grid-template-columns: 40px repeat(5, 1fr); gap: 1px; background: #9ca3af; border: 2px solid #4b5563; }
        .editor-cell { background: white; min-height: 60px; padding: 1px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; cursor: pointer; font-size: 0.85rem; position: relative; user-select: none; }
        .cell-blocked { background-color: #e5e7eb; background-image: linear-gradient(45deg, #d1d5db 25%, transparent 25%, transparent 50%, #d1d5db 50%, #d1d5db 75%, transparent 75%, transparent); background-size: 10px 10px; }
        .cell-special { background-color: #fff7ed; border: 2px dashed #f97316; }
        .cell-sys-blocked { background-color: #d1d5db !important; cursor: not-allowed; pointer-events: none; border: 1px solid #9ca3af; background-image: linear-gradient(135deg, #999 10%, transparent 10%, transparent 50%, #999 50%, #999 60%, transparent 60%, transparent); background-size: 10px 10px; }
        .matrix-table th { white-space: nowrap; padding: 6px; background: #e5e7eb; position: sticky; top: 0; z-index: 10; border: 1px solid #d1d5db; font-size: 0.85rem; }
        .matrix-table td { padding: 2px; border: 1px solid #d1d5db; text-align: center; }
        .matrix-input { width: 100%; text-align: center; border: 1px solid transparent; border-radius: 4px; font-size: 0.85rem; }
        .matrix-input:focus { border-color: #3b82f6; background: #eff6ff; }
        .has-value { background-color: #eff6ff; font-weight: bold; color: #1e3a8a; }
        .assign-matrix-wrapper { max-height: 60vh; overflow: auto; position: relative; border: 1px solid #ccc; }
        .assign-matrix-table { border-collapse: separate; border-spacing: 0; }
        .assign-matrix-table th.sticky-header { position: sticky; top: 0; z-index: 20; background: #f3f4f6; border-bottom: 2px solid #ccc; }
        .assign-matrix-table td.sticky-col { position: sticky; left: 0; z-index: 15; background: #fff; border-right: 2px solid #ccc; }
        .assign-matrix-table th.sticky-corner { position: sticky; top: 0; left: 0; z-index: 30; background: #e5e7eb; border-bottom: 2px solid #ccc; border-right: 2px solid #ccc; }
        .assign-cell { cursor: pointer; transition: all 0.1s; min-width: 60px; height: 50px; border-bottom: 1px solid #eee; border-right: 1px solid #eee; }
        .assign-cell:hover { background-color: #e0f2fe; } .assign-cell.active { background-color: #bfdbfe; border: 2px solid #2563eb; }
        .target-input { width: 100%; text-align: center; font-weight: bold; border: none; background: transparent; font-size: 1rem; }
        .actual-count { font-size: 0.7rem; color: #666; display: block; }
        .match-ok { color: #16a34a; } .match-fail { color: #dc2626; font-weight: bold; }
        .compact-select { font-size: 0.75rem; padding: 1px; height: 24px; border-radius: 3px; border: 1px solid #ccc; width: 100%; max-width: 100px; }
        .class-btn { border: 1px solid #d1d5db; border-radius: 4px; padding: 4px 8px; text-align: center; cursor: pointer; transition: all 0.1s; user-select: none; display: flex; align-items: center; justify-content: center; gap: 4px; min-width: 80px; }
        .class-btn:active, .class-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; font-weight: bold; }
        .class-btn.disabled { opacity: 0.4; cursor: not-allowed; background-color: #f9fafb; }
        .mini-btn { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(255,255,255,0.3); color: white; font-size: 0.7rem; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; border: 1px solid rgba(0,0,0,0.1); }
        .dot-green { background: #22c55e; box-shadow: 0 0 5px #22c55e; } .dot-red { background: #ef4444; box-shadow: 0 0 5px #ef4444; animation: pulse 1s infinite; }
        .stats-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .tag-reduction { background: #fee2e2; color: #991b1b; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .tag-overtime { background: #dcfce7; color: #166534; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .simple-print-table { width: 100%; border-collapse: collapse; border: 2px solid #000; table-layout: fixed; }
        .simple-print-table th, .simple-print-table td { border: 1px solid #000; text-align: center; padding: 4px; vertical-align: middle; }
        .simple-print-table th { background-color: #f3f4f6; height: 35px; font-size: 14px; font-weight: bold; }
        .print-cell-content { min-height: 50px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .print-subject { font-size: 16px; font-weight: bold; }
        .print-sub-info { font-size: 12px; font-weight: bold; color: #000; margin-top: 2px; }
        .print-x { font-size: 20px; font-weight: bold; color: #888; }
        .rule-card { transition: all 0.3s; cursor: pointer; }
        @media print { .no-print { display: none !important; } body { background: white; margin: 0; padding: 0; } .print-area { display: block !important; padding: 0; } .print-page-break { page-break-after: always; } .layout-container { display: block; } .layout-sidebar { display: none; } }
    </style>
</head>
<body class="pb-20">
    <div id="app">
        <div class="bg-gray-800 text-white p-3 sticky top-0 z-50 shadow no-print">
            <div class="flex flex-wrap justify-between items-center max-w-[1800px] mx-auto gap-2">
                <div class="flex items-center gap-4">
                    <h1 class="text-xl font-bold text-yellow-400">üè´ ÊéíË™≤ V48.1</h1>
                    <nav class="flex bg-gray-700 rounded p-1 gap-1 flex-wrap">
                        <button v-for="tab in tabs" :key="tab.id" @click="currentTab=tab.id" :class="currentTab===tab.id ? 'bg-yellow-500 text-black font-bold' : 'text-gray-300 hover:bg-gray-600'" class="px-3 py-1 rounded text-sm transition">{{ tab.name }}</button>
                    </nav>
                </div>
                <div class="flex gap-2 text-sm"><button @click="saveData(true)" class="btn btn-green">üíæ ÂÑ≤Â≠ò</button><button @click="exportData" class="btn btn-blue">üì§ ÂÇô‰ªΩ</button><label class="btn btn-blue cursor-pointer bg-yellow-600 hover:bg-yellow-700">üì• ÂåØÂÖ• <input type="file" @change="importData" class="hidden"></label><button @click="resetData" class="btn btn-red">‚ö†Ô∏è ÈáçÁΩÆ</button></div>
            </div>
        </div>

        <div class="p-4 max-w-[1800px] mx-auto">
            <div v-show="currentTab === 'settings'" class="space-y-4 no-print">
                <div class="bg-white p-4 rounded shadow border-l-4 border-purple-500 overflow-x-auto"><h3 class="font-bold text-lg mb-2 text-purple-900">üìä 01. ÁØÄÊï∏Ë®≠ÂÆöÁü©Èô£</h3><div class="max-h-[60vh] overflow-auto"><table class="w-full text-sm border-collapse matrix-table"><thead><tr><th class="z-20 left-0 bg-gray-200">Âπ¥Á¥ö \ ÁßëÁõÆ</th><th v-for="(sub, idx) in subjects" :key="idx" class="min-w-[60px]"><div class="flex flex-col items-center"><span class="font-bold" :class="getSubjectColor(sub.zh)">{{sub.zh}}</span><span class="text-[9px] text-gray-500 bg-gray-100 px-1 rounded">{{sub.alias}}</span></div></th><th class="min-w-[50px] bg-gray-800 text-white sticky right-0 z-20">Á∏ΩË®à</th></tr></thead><tbody><tr v-for="g in 6" :key="g"><td class="font-bold bg-gray-50 sticky left-0 z-10">{{ g }} Âπ¥Á¥ö</td><td v-for="sub in subjects" :key="sub.zh"><input typ
